{"format_version":"0.1","terraform_version":"0.12.29","planned_values":{"outputs":{"this_iam_role_arn":{"sensitive":false,"value":"module.iam_assumable_role_admin.aws_iam_role.this[0].arn"},"this_iam_role_name":{"sensitive":false,"value":"role-with-oidc"},"this_iam_role_path":{"sensitive":false,"value":"/"}},"root_module":{"child_modules":[{"resources":[{"address":"module.iam_assumable_role_admin.aws_iam_role.this[0]","mode":"managed","type":"aws_iam_role","name":"this","index":0,"provider_name":"aws","schema_version":0,"values":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8:sub\": [\n            \"system:serviceaccount:default:sa2\",\n            \"system:serviceaccount:default:sa1\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8:sub\": [\n            \"system:serviceaccount:default:sa2\",\n            \"system:serviceaccount:default:sa1\"\n          ]\n        }\n      }\n    }\n  ]\n}","description":"","force_detach_policies":false,"max_session_duration":3600,"name":"role-with-oidc","name_prefix":null,"path":"/","permissions_boundary":"","tags":{"Role":"role-with-oidc"}}},{"address":"module.iam_assumable_role_admin.aws_iam_role_policy_attachment.custom[0]","mode":"managed","type":"aws_iam_role_policy_attachment","name":"custom","index":0,"provider_name":"aws","schema_version":0,"values":{"policy_arn":"arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy","role":"role-with-oidc"}}],"address":"module.iam_assumable_role_admin"}]}},"resource_changes":[{"address":"module.iam_assumable_role_admin.aws_iam_role.this[0]","module_address":"module.iam_assumable_role_admin","mode":"managed","type":"aws_iam_role","name":"this","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8:sub\": [\n            \"system:serviceaccount:default:sa2\",\n            \"system:serviceaccount:default:sa1\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8:sub\": [\n            \"system:serviceaccount:default:sa2\",\n            \"system:serviceaccount:default:sa1\"\n          ]\n        }\n      }\n    }\n  ]\n}","description":"","force_detach_policies":false,"max_session_duration":3600,"name":"role-with-oidc","name_prefix":null,"path":"/","permissions_boundary":"","tags":{"Role":"role-with-oidc"}},"after_unknown":{"arn":true,"create_date":true,"id":true,"tags":{},"unique_id":true}}},{"address":"module.iam_assumable_role_admin.aws_iam_role_policy_attachment.custom[0]","module_address":"module.iam_assumable_role_admin","mode":"managed","type":"aws_iam_role_policy_attachment","name":"custom","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"policy_arn":"arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy","role":"role-with-oidc"},"after_unknown":{"id":true}}}],"output_changes":{"this_iam_role_arn":{"actions":["create"],"before":null,"after":"module.iam_assumable_role_admin.aws_iam_role.this[0].arn","after_unknown":false},"this_iam_role_name":{"actions":["create"],"before":null,"after":"role-with-oidc","after_unknown":false},"this_iam_role_path":{"actions":["create"],"before":null,"after":"/","after_unknown":false}},"prior_state":{"format_version":"0.1","terraform_version":"0.12.29","values":{"root_module":{"child_modules":[{"resources":[{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_name":"aws","schema_version":0,"values":{"account_id":"167389268608","arn":"arn:aws:sts::167389268608:assumed-role/AWSReservedSSO_admin_in_develop_7b13d69800adca00/y@indeni.com","id":"167389268608","user_id":"AROASN6JNRKAJ56VZ6FY7:y@indeni.com"}},{"address":"data.aws_iam_policy_document.assume_role_with_oidc","mode":"data","type":"aws_iam_policy_document","name":"assume_role_with_oidc","index":0,"provider_name":"aws","schema_version":0,"values":{"id":"2756091693","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8:sub\": [\n            \"system:serviceaccount:default:sa2\",\n            \"system:serviceaccount:default:sa1\"\n          ]\n        }\n      }\n    },\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Principal\": {\n        \"Federated\": \"arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8\"\n      },\n      \"Condition\": {\n        \"StringEquals\": {\n          \"oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8:sub\": [\n            \"system:serviceaccount:default:sa2\",\n            \"system:serviceaccount:default:sa1\"\n          ]\n        }\n      }\n    }\n  ]\n}","override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["sts:AssumeRoleWithWebIdentity"],"condition":[{"test":"StringEquals","values":["system:serviceaccount:default:sa1","system:serviceaccount:default:sa2"],"variable":"oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8:sub"}],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8"],"type":"Federated"}],"resources":[],"sid":""},{"actions":["sts:AssumeRoleWithWebIdentity"],"condition":[{"test":"StringEquals","values":["system:serviceaccount:default:sa1","system:serviceaccount:default:sa2"],"variable":"oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8:sub"}],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["arn:aws:iam::167389268608:oidc-provider/oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8"],"type":"Federated"}],"resources":[],"sid":""}],"version":"2012-10-17"}},{"address":"data.aws_partition.current","mode":"data","type":"aws_partition","name":"current","provider_name":"aws","schema_version":0,"values":{"dns_suffix":"amazonaws.com","id":"aws","partition":"aws","reverse_dns_prefix":"com.amazonaws"}}],"address":"module.iam_assumable_role_admin"}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","expressions":{"region":{"constant_value":"eu-west-1"}}}},"root_module":{"outputs":{"this_iam_role_arn":{"expression":{"references":["module.iam_assumable_role_admin.this_iam_role_arn"]},"description":"ARN of IAM role"},"this_iam_role_name":{"expression":{"references":["module.iam_assumable_role_admin.this_iam_role_name"]},"description":"Name of IAM role"},"this_iam_role_path":{"expression":{"references":["module.iam_assumable_role_admin.this_iam_role_path"]},"description":"Path of IAM role"}},"module_calls":{"iam_assumable_role_admin":{"source":"../../modules/iam-assumable-role-with-oidc","expressions":{"create_role":{"constant_value":true},"oidc_fully_qualified_subjects":{"constant_value":["system:serviceaccount:default:sa1","system:serviceaccount:default:sa2"]},"provider_url":{"constant_value":"oidc.eks.eu-west-1.amazonaws.com/id/BA9E170D464AF7B92084EF72A69B9DC8"},"provider_urls":{"constant_value":["oidc.eks.eu-west-1.amazonaws.com/id/AA9E170D464AF7B92084EF72A69B9DC8"]},"role_name":{"constant_value":"role-with-oidc"},"role_policy_arns":{"constant_value":["arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy"]},"tags":{"constant_value":{"Role":"role-with-oidc"}}},"module":{"outputs":{"this_iam_role_arn":{"expression":{"references":["aws_iam_role.this"]},"description":"ARN of IAM role"},"this_iam_role_name":{"expression":{"references":["aws_iam_role.this"]},"description":"Name of IAM role"},"this_iam_role_path":{"expression":{"references":["aws_iam_role.this"]},"description":"Path of IAM role"}},"resources":[{"address":"aws_iam_role.this","mode":"managed","type":"aws_iam_role","name":"this","provider_config_key":"iam_assumable_role_admin:aws","expressions":{"assume_role_policy":{"references":["data.aws_iam_policy_document.assume_role_with_oidc"]},"description":{"references":["var.role_description"]},"force_detach_policies":{"references":["var.force_detach_policies"]},"max_session_duration":{"references":["var.max_session_duration"]},"name":{"references":["var.role_name"]},"name_prefix":{"references":["var.role_name_prefix"]},"path":{"references":["var.role_path"]},"permissions_boundary":{"references":["var.role_permissions_boundary_arn"]},"tags":{"references":["var.tags"]}},"schema_version":0,"count_expression":{"references":["var.create_role"]},"raw_data":{"FileName":"../../modules/iam-assumable-role-with-oidc/main.tf","StartLine":55,"EndLine":70}},{"address":"aws_iam_role_policy_attachment.custom","mode":"managed","type":"aws_iam_role_policy_attachment","name":"custom","provider_config_key":"iam_assumable_role_admin:aws","expressions":{"policy_arn":{"references":["var.role_policy_arns","count.index"]},"role":{"references":["aws_iam_role.this"]}},"schema_version":0,"count_expression":{"references":["var.create_role","local.number_of_role_policy_arns"]},"raw_data":{"FileName":"../../modules/iam-assumable-role-with-oidc/main.tf","StartLine":72,"EndLine":77}},{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_config_key":"iam_assumable_role_admin:aws","schema_version":0,"raw_data":{"FileName":"../../modules/iam-assumable-role-with-oidc/main.tf","StartLine":11,"EndLine":11}},{"address":"data.aws_iam_policy_document.assume_role_with_oidc","mode":"data","type":"aws_iam_policy_document","name":"assume_role_with_oidc","provider_config_key":"iam_assumable_role_admin:aws","schema_version":0,"count_expression":{"references":["var.create_role"]},"raw_data":{"FileName":"../../modules/iam-assumable-role-with-oidc/main.tf","StartLine":15,"EndLine":53}},{"address":"data.aws_partition.current","mode":"data","type":"aws_partition","name":"current","provider_config_key":"iam_assumable_role_admin:aws","schema_version":0,"raw_data":{"FileName":"../../modules/iam-assumable-role-with-oidc/main.tf","StartLine":13,"EndLine":13}}],"variables":{"aws_account_id":{"default":"","description":"The AWS account ID where the OIDC provider lives, leave empty to use the account for the AWS provider"},"create_role":{"default":false,"description":"Whether to create a role"},"force_detach_policies":{"default":false,"description":"Whether policies should be detached from this role when destroying"},"max_session_duration":{"default":3600,"description":"Maximum CLI/API session duration in seconds between 3600 and 43200"},"number_of_role_policy_arns":{"default":null,"description":"Number of IAM policies to attach to IAM role"},"oidc_fully_qualified_subjects":{"default":[],"description":"The fully qualified OIDC subjects to be added to the role policy"},"oidc_subjects_with_wildcards":{"default":[],"description":"The OIDC subject using wildcards to be added to the role policy"},"provider_url":{"default":"","description":"URL of the OIDC Provider. Use provider_urls to specify several URLs."},"provider_urls":{"default":[],"description":"List of URLs of the OIDC Providers"},"role_description":{"default":"","description":"IAM Role description"},"role_name":{"default":null,"description":"IAM role name"},"role_name_prefix":{"default":null,"description":"IAM role name prefix"},"role_path":{"default":"/","description":"Path of IAM role"},"role_permissions_boundary_arn":{"default":"","description":"Permissions boundary ARN to use for IAM role"},"role_policy_arns":{"default":[],"description":"List of ARNs of IAM policies to attach to IAM role"},"tags":{"default":{},"description":"A map of tags to add to IAM role resources"}}},"raw_data":{"FileName":"main.tf","StartLine":8,"EndLine":27}}}}}}
