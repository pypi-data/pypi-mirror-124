"use strict";(self.webpackChunkjupyterlab_nbplusplus=self.webpackChunkjupyterlab_nbplusplus||[]).push([[568],{568:(e,t,n)=>{n.r(t),n.d(t,{default:()=>T});var l=n(476),s=n(973);const o="nbplusplus",d={id:"jupyterlab-nbplusplus",requires:[s.INotebookTracker],autoStart:!0,activate:(e,t)=>{t.widgetAdded.connect(((e,t)=>{const n=t.sessionContext;n.ready.then((()=>{I(t.content),C=t.content.activeCell,w=t.content.activeCell.model.id;let e=()=>{};n.session.kernel.name===o&&(e=N(n,t.content)),n.kernelChanged.connect(((l,s)=>{I(t.content),e(),e=()=>{},null!==s.newValue&&s.newValue.name===o&&(e=N(n,t.content))}));let l=!1;n.statusChanged.connect(((n,s)=>{"restarting"!==s&&"autorestarting"!==s||(l=!0),"idle"!==s&&"busy"!==s||!l||(l=!1,n.ready.then((()=>{I(t.content),e(),e=()=>{},n.session.kernel.name===o&&(e=N(n,t.content))})))}))}))}))}},a="stale-cell",c="fresh-cell",i="refresher-cell",r="refresher-input-cell",u="linked-stale",m="linked-refresher";let h=new Set,f=new Set,v=new Set,p={},_={},C=null,w=null,E={},L={},g=null,y=null,b=null,S=new Set,k=new Set,x=new Set;const j=new Event("cleanup"),D=e=>{if(null==e)return null;const t=e.children.item(1);return null===t?null:t.firstElementChild},O=e=>{if(null==e)return null;const t=e.children.item(2);return null===t?null:t.firstElementChild},V=(e,t,n)=>{const l=()=>{e.removeEventListener(t,n),e.removeEventListener("cleanup",l)};e.addEventListener(t,n),e.addEventListener("cleanup",l)},P=(e,t,n,l,s)=>{null!==e&&null!==t&&V(e,n,(()=>{t.firstElementChild.classList[l](s)}))},q=(e,t)=>{P(D(e),O(e),"mouseover","add",u),P(D(e),O(e),"mouseout","remove",u),P(O(e),D(e),"mouseover","add",t),P(O(e),D(e),"mouseout","remove",t)},A=e=>{E={},L={},e.widgets.forEach(((e,t)=>{E[e.model.id]=e.node,L[e.model.id]=t}))},I=e=>{e.widgets.forEach(((e,t)=>{e.node.classList.remove(a),e.node.classList.remove(i),e.node.classList.remove(c),e.node.classList.remove(r);const n=D(e.node);null!==n&&(n.firstElementChild.classList.remove(u),n.firstElementChild.classList.remove(m),n.dispatchEvent(j));const l=O(e.node);null!==l&&(l.firstElementChild.classList.remove(u),l.firstElementChild.classList.remove(m),l.dispatchEvent(j))}))},M=(e,t,n,l,s,o,d)=>{if(null===e)return;const a=()=>{for(const e of t){let t=m;d.has(e)&&(t=u);const s=l(n[e]);if(null===s||null===s.firstElementChild)return;s.firstElementChild.classList[o](t)}};e.addEventListener(s,a),V(e,s,a)},N=(e,t)=>{const n=e.session.kernel.createComm("nbplusplus");let s=!1;const o=(d,a)=>{if(s)return void d.stateChanged.disconnect(o);if("executionCount"!==a.name||null===a.newValue)return;const i={};t.widgets.forEach(((e,t)=>{i[e.model.id]=t,e.model.id===d.id&&(e.node.classList.remove(c),e.node.classList.remove(r))}));const u={type:"cell_freshness",executed_cell_id:d.id,order_index_by_cell_id:i};n.send(u).done.then((()=>{null!==g?l.CodeCell.execute(g,e):("reactive"===y&&(v=S,P(t)),k=new Set,x=new Set,S=new Set,n.send({type:"reactivity_cleanup"}))}))},d=e=>{let l=-1;t.widgets.forEach(((t,n)=>{t.model.id===e.id&&(l=n)}));const s={type:"change_active_cell",active_cell_id:e.id,active_cell_order_idx:l};n.send(s)},L=(e,n)=>{if(t===e)if(s)t.activeCellChanged.disconnect(L);else if(d(n.model),null!==C&&null!==C.model&&(C.model.isDirty?h.add(w):h.delete(w),C.model.stateChanged.disconnect(o,C.model.stateChanged)),C=n,w=n.model.id,null!==C&&null!==C.model&&"code"===C.model.type){if(C.model.stateChanged.connect(o),d(C.model),h.has(w)){const e=C.model;void 0!==e._setDirty&&e._setDirty(!0)}A(t),V(w)}};t.activeCellChanged.connect(L);const j=[{action:"mouseover",update:"add"},{action:"mouseout",update:"remove"}],V=e=>{const t=E[e];f.has(e)?(t.classList.add(a),t.classList.add(c),t.classList.remove(r),q(t,u)):v.has(e)&&(t.classList.add(r),"normal"===y&&(t.classList.add(c),q(t,m))),"reactive"!==y&&(p.hasOwnProperty(e)&&j.forEach((({action:n,update:l})=>{M(D(t),p[e],E,D,n,l,f),M(O(t),p[e],E,D,n,l,f)})),_.hasOwnProperty(e)&&(f.has(e)||(t.classList.add(i),t.classList.add(c)),j.forEach((({action:n,update:l})=>{M(D(t),_[e],E,D,n,l,f),M(D(t),_[e],E,O,n,l,f)}))))},P=e=>{if(I(e),b){A(e);for(const[e]of Object.entries(E))V(e)}};return n.onMsg=e=>{if(!s)if("establish"===e.content.data.type)t.activeCell.model.stateChanged.connect(o),d(t.activeCell.model);else if("cell_freshness"===e.content.data.type){f=new Set(e.content.data.stale_cells),v=new Set(e.content.data.fresh_cells),k=new Set([...k,...e.content.data.new_fresh_cells]),x=new Set([...x,...e.content.data.forced_reactive_cells]),p=e.content.data.stale_links,_=e.content.data.refresher_links,g=null;const n=e.content.data.exec_mode,l=e.content.data.flow_order;y=n,b=e.content.data.highlights_enabled,S.add(e.content.data.last_executed_cell_id);let s=!1;t.widgets.forEach((e=>{if(!s&&"code"===e.model.type&&!S.has(e.model.id)&&("reactive"===n&&k.has(e.model.id)||x.has(e.model.id))){const t=e;null===g?(g=t,s="in_order"===l||"strict"===l):null!==t.model.executionCount&&t.model.executionCount<g.model.executionCount&&(g=t)}})),null===g?(k=new Set,x=new Set,P(t)):I(t)}},n.open({}),()=>{s=!0}},T=d}}]);